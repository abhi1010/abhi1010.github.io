<!doctype html>
<html lang="en-us">
  <head>
    <title>Upgrading from dual momentum // Coders Digest</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.145.0">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Abhishek Pandey" />
    <meta name="description" content="Triple Momentum Trading Strategy: A Python Implementation" />
    <link rel="stylesheet" href="/css/main.min.3fabd88a6b1988deec4988ebf6c9df8b45b30a933ac9db6bfd68596e780921ab.css" />
    

    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Upgrading from dual momentum">
  <meta name="twitter:description" content="Triple Momentum Trading Strategy: A Python Implementation">

    <meta property="og:url" content="http://abhipandey.com/2023/03/upgrading-from-dual-momentum/">
  <meta property="og:site_name" content="Coders Digest">
  <meta property="og:title" content="Upgrading from dual momentum">
  <meta property="og:description" content="Triple Momentum Trading Strategy: A Python Implementation">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2023-03-11T00:33:29+08:00">
    <meta property="article:modified_time" content="2023-03-11T00:33:29+08:00">
    <meta property="article:tag" content="Strategy">
    <meta property="article:tag" content="Python">


  </head>
  <body>
    <header class="app-header">
      <a href="/"><img class="app-header-avatar" src="/space-2.jpg" alt="Abhishek Pandey" /></a>
      <span class="app-header-title">Coders Digest</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/post/">Posts</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
             - 
          
          <a class="app-header-menu-item" href="/categories/">Categories</a>
             - 
          
          <a class="app-header-menu-item" href="/about/">About</a>
      </nav>
      <p>Abhishek Pandey</p>
      <div class="app-header-social">
        
          <a href="https://github.com/abhi1010" target="_blank" rel="noreferrer noopener me">
            <svg class="icon icon-brand-github" viewBox="0 0 24 24" fill="currentColor"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
          </a>
        
          <a href="https://www.linkedin.com/in/apandey10/" target="_blank" rel="noreferrer noopener me">
            <svg class="icon icon-brand-linkedin" viewBox="0 0 24 24" fill="currentColor"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Upgrading from dual momentum</h1>
      <div class="post-meta">
        <div>
          <svg class="icon icon-calendar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
          Mar 11, 2023
        </div>
        <div>
          <svg class="icon icon-clock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>clock</title><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
          4 min read
        </div>
        <div>
          <svg class="icon icon-tag" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
              <a class="tag" href="/tags/strategy/">Strategy</a>
              <a class="tag" href="/tags/python/">Python</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <p>In the world of algorithmic trading, momentum strategies hold a special place for their simplicity and effectiveness. Today, I want to share a Python implementation of a &ldquo;Triple Momentum&rdquo; strategy that I&rsquo;ve been working with. This approach allows you to dynamically switch between three different assets based on their relative momentum.</p>
<h2 id="what-is-momentum-trading">What is Momentum Trading?</h2>
<p>Before diving into the code, let&rsquo;s briefly understand what momentum trading is. The core idea is simple: assets that have performed well recently tend to continue performing well in the near future. By measuring and comparing the momentum of different assets, we can allocate our capital to the one showing the strongest trend.</p>
<h2 id="the-triple-momentum-approach">The Triple Momentum Approach</h2>
<p>The strategy I&rsquo;m sharing allows you to compare three different assets - typically this could be:</p>
<ul>
<li>A primary market index (like NIFTY)</li>
<li>An alternative asset (like USD/INR currency pair)</li>
<li>A third option (like Gold)</li>
</ul>
<p>The algorithm calculates normalized momentum for each asset and allocates 100% of the portfolio to whichever is showing the strongest momentum at the time.</p>
<h2 id="the-python-implementation">The Python Implementation</h2>
<p>Let&rsquo;s walk through the key components of the implementation:</p>
<h3 id="setting-up-the-environment">Setting Up the Environment</h3>
<p>The code uses several popular Python libraries for financial analysis:</p>
<ul>
<li>pandas for data manipulation</li>
<li>yfinance for fetching market data</li>
<li>matplotlib and plotly for visualization</li>
</ul>
<h3 id="calculating-momentum">Calculating Momentum</h3>
<p>The heart of the strategy lies in how we calculate momentum:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f00">def</span> <span style="color:#ff0">calc_returns</span>(df, suffix=<span style="color:#87ceeb">&#39;&#39;</span>):
</span></span><span style="display:flex;"><span>    df = df.copy()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#0f0"># Rename columns with suffix</span>
</span></span><span style="display:flex;"><span>    rename_dict = {col: <span style="color:#87ceeb">f</span><span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">{</span>col<span style="color:#87ceeb">}{</span>suffix<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span> <span style="color:#f00">for</span> col in df.columns}
</span></span><span style="display:flex;"><span>    df = df.rename(columns=rename_dict)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#0f0"># Calculate momentum metrics</span>
</span></span><span style="display:flex;"><span>    returns_col = <span style="color:#87ceeb">f</span><span style="color:#87ceeb">&#39;returns</span><span style="color:#87ceeb">{</span>suffix<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#39;</span>
</span></span><span style="display:flex;"><span>    mean_col = <span style="color:#87ceeb">f</span><span style="color:#87ceeb">&#39;mean</span><span style="color:#87ceeb">{</span>suffix<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#39;</span>
</span></span><span style="display:flex;"><span>    std_col = <span style="color:#87ceeb">f</span><span style="color:#87ceeb">&#39;std</span><span style="color:#87ceeb">{</span>suffix<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#39;</span>
</span></span><span style="display:flex;"><span>    norm_returns_col = <span style="color:#87ceeb">f</span><span style="color:#87ceeb">&#39;norm_returns</span><span style="color:#87ceeb">{</span>suffix<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    df[returns_col] = df[<span style="color:#87ceeb">f</span><span style="color:#87ceeb">&#39;Close</span><span style="color:#87ceeb">{</span>suffix<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#39;</span>].pct_change(<span style="color:#f60">21</span>)  <span style="color:#0f0"># 21-day returns</span>
</span></span><span style="display:flex;"><span>    df[mean_col] = df[returns_col].rolling(<span style="color:#f60">4</span>).mean()        <span style="color:#0f0"># 4-period average</span>
</span></span><span style="display:flex;"><span>    df[std_col] = df[mean_col].rolling(<span style="color:#f60">4</span>).std()             <span style="color:#0f0"># Standard deviation</span>
</span></span><span style="display:flex;"><span>    df[norm_returns_col] = df[mean_col] / df[std_col]       <span style="color:#0f0"># Normalized returns</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f00">return</span> df
</span></span></code></pre></div><p>The key metrics here are:</p>
<ol>
<li>21-day price returns</li>
<li>4-period rolling average of these returns</li>
<li>4-period standard deviation of the average</li>
<li>Normalized returns (mean divided by standard deviation)</li>
</ol>
<p>This normalization helps compare assets with different volatility profiles on equal footing.</p>
<h3 id="determining-the-best-asset">Determining the Best Asset</h3>
<p>Once we have the normalized returns for each asset, we simply identify which one has the highest value:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0f0"># Calculate highest returns using aligned comparisons</span>
</span></span><span style="display:flex;"><span>df_merged[<span style="color:#87ceeb">&#39;norm_returns_first_is_highest&#39;</span>] = ((norm_first &gt; norm_second) &amp;
</span></span><span style="display:flex;"><span>                                             (norm_first &gt; norm_third))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df_merged[<span style="color:#87ceeb">&#39;norm_returns_second_is_highest&#39;</span>] = ((norm_second &gt; norm_first) &amp;
</span></span><span style="display:flex;"><span>                                              (norm_second &gt; norm_third))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df_merged[<span style="color:#87ceeb">&#39;norm_returns_third_is_highest&#39;</span>] = ((norm_third &gt; norm_first) &amp;
</span></span><span style="display:flex;"><span>                                             (norm_third &gt; norm_second))
</span></span></code></pre></div><h3 id="portfolio-management">Portfolio Management</h3>
<p>The strategy then calculates portfolio metrics based on the chosen asset:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0f0"># Calculate strategy returns (only one position will be active at a time)</span>
</span></span><span style="display:flex;"><span>df[<span style="color:#87ceeb">&#39;strategy_returns&#39;</span>] = (
</span></span><span style="display:flex;"><span>    df[<span style="color:#87ceeb">&#39;first_position&#39;</span>].shift(<span style="color:#f60">1</span>) * df[<span style="color:#87ceeb">&#39;first_returns&#39;</span>] +
</span></span><span style="display:flex;"><span>    df[<span style="color:#87ceeb">&#39;second_position&#39;</span>].shift(<span style="color:#f60">1</span>) * df[<span style="color:#87ceeb">&#39;second_returns&#39;</span>] +
</span></span><span style="display:flex;"><span>    df[<span style="color:#87ceeb">&#39;third_position&#39;</span>].shift(<span style="color:#f60">1</span>) * df[<span style="color:#87ceeb">&#39;third_returns&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df[<span style="color:#87ceeb">&#39;cumulative_returns&#39;</span>] = (<span style="color:#f60">1</span> + df[<span style="color:#87ceeb">&#39;strategy_returns&#39;</span>]).cumprod()
</span></span><span style="display:flex;"><span>df[<span style="color:#87ceeb">&#39;portfolio_value&#39;</span>] = initial_capital * df[<span style="color:#87ceeb">&#39;cumulative_returns&#39;</span>]
</span></span></code></pre></div><p>Notice that we use <code>shift(1)</code> to ensure we&rsquo;re making decisions based on previous signals, not current ones, avoiding look-ahead bias.</p>
<h2 id="running-the-strategy">Running the Strategy</h2>
<p>You can run the strategy with different asset combinations. For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python trading/strategies/triple_momentum.py <span style="color:#87ceeb">\
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb"></span>  --main-col NIFTY <span style="color:#87ceeb">\
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb"></span>  --main-ticker ^NSEI <span style="color:#87ceeb">\
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb"></span>  --alt-col USDINR <span style="color:#87ceeb">\
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb"></span>  --alt-ticker <span style="color:#eedd82">USDINR</span>=X <span style="color:#87ceeb">\
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb"></span>  --third-col GLD <span style="color:#87ceeb">\
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb"></span>  --third-ticker GLD <span style="color:#87ceeb">\
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb"></span>  --output-dir data/triple-momentum <span style="color:#87ceeb">\
</span></span></span><span style="display:flex;"><span><span style="color:#87ceeb"></span>  --initial-capital <span style="color:#f60">100000</span>
</span></span></code></pre></div><h2 id="results-and-monitoring">Results and Monitoring</h2>
<p>The code includes functionality to generate notifications about position changes. Here&rsquo;s how the final output looks:</p>
<pre tabindex="0"><code>Triple Momentum =
</code></pre><p>Edit: Updated the output to be more readable. Followed by a table showing the prices of the three assets and which one to buy according to the strategy.
According to this sample below, <code>NIFTY</code> was a good buy on 02-Apr-2025.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Triple Momentum :
</span></span><span style="display:flex;"><span>               NIFTY  USDINR     GLD     BUY
</span></span><span style="display:flex;"><span>Date
</span></span><span style="display:flex;"><span>2024-12-11  24641.80   84.87  250.96   NIFTY
</span></span><span style="display:flex;"><span>2024-12-18  24198.85   84.92  239.26  USDINR
</span></span><span style="display:flex;"><span>2024-12-19  23951.70   85.17  239.60   NIFTY
</span></span><span style="display:flex;"><span>2024-12-31  23644.80   85.79  242.13  USDINR
</span></span><span style="display:flex;"><span>2025-01-31  23508.40   86.65  258.56     GLD
</span></span><span style="display:flex;"><span>2025-02-05  23696.30   87.13  264.13  USDINR
</span></span><span style="display:flex;"><span>2025-02-14  22929.25   86.75  266.29     GLD
</span></span><span style="display:flex;"><span>2025-03-05  22337.30   87.22  269.62  USDINR
</span></span><span style="display:flex;"><span>2025-03-27  23591.95   86.10  281.97     GLD
</span></span><span style="display:flex;"><span>2025-04-02  23332.35   85.61  288.16   NIFTY
</span></span></code></pre></div><h2 id="key-features-of-the-implementation">Key Features of the Implementation</h2>
<ol>
<li><strong>Dynamic Asset Selection</strong>: Automatically switches between three assets based on momentum</li>
<li><strong>Risk Management</strong>: Standard deviation normalization helps account for volatility</li>
<li><strong>Clean Position Switching</strong>: Only trades when momentum leadership changes</li>
<li><strong>Backtesting Capabilities</strong>: Calculates portfolio value over time with initial capital</li>
</ol>
<h2 id="potential-improvements">Potential Improvements</h2>
<p>While this implementation works well as a starting point, here are some ways you might enhance it:</p>
<ol>
<li>Add transaction costs to make the backtest more realistic</li>
<li>Implement a trailing stop-loss for each position</li>
<li>Add a threshold to prevent excessive switching between assets</li>
<li>Incorporate volume or other technical indicators to confirm momentum</li>
</ol>
<h2 id="conclusion">Conclusion</h2>
<p>The Triple Momentum strategy offers a straightforward yet powerful approach to asset allocation. By measuring relative momentum across three different assets, you can potentially enhance returns while maintaining a simple trading system.</p>
<p>Remember that any trading strategy should be thoroughly tested with historical data and gradually implemented with proper risk management. No strategy works in all market conditions, and past performance doesn&rsquo;t guarantee future results.</p>
<p>Happy trading!</p>

    </div>
    <div class="post-footer">
      <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "abhi1010" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </article>

    </main>
  </body>
</html>
